<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta property="og:description" content="SKrypt is a very clean and fast proxy" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - SKrypt</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="inde.x.css">
    <style>
        /* Existing Theme Styles */
        body[theme="skibididdy"] {
            background: url("https://gifdb.com/images/high/cyberpunk-pixel-city-neon-2bagugxcfp2to7tx.gif") no-repeat center center fixed;
            background-size: cover;
            --text: #cdd6f4;
            --card-bg: rgba(0, 0, 0, 0.5); /* Example: Added for consistency */
            --glass-border: rgba(255, 255, 255, 0.2); /* Example: Added for consistency */
            --primary-light: #66ccff; /* Example: Added for clock color */
            --shadow-strong: rgba(0, 0, 0, 0.8); /* Example: Added for clock shadow */
        }

        body[theme="cuhs"] {
            background: url("/assets/media/background/poppingthatGTV.jpg") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
            --card-bg: rgba(0, 0, 0, 0.5);
            --glass-border: rgba(255, 255, 255, 0.2);
            --primary-light: #cdd6f4;
            --shadow-strong: rgba(0, 0, 0, 0.8);
        }

        body[theme="cuhs2"] {
            background: url("/assets/media/background/stadning.jpg") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
            --card-bg: rgba(0, 0, 0, 0.5);
            --glass-border: rgba(255, 255, 255, 0.2);
            --primary-light: #cdd6f4;
            --shadow-strong: rgba(0, 0, 0, 0.8);
        }

        body[theme="cuhs3"] {
            background: url("/assets/media/background/Pacificthatis.jpg") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
            --card-bg: rgba(0, 0, 0, 0.5);
            --glass-border: rgba(255, 255, 255, 0.2);
            --primary-light: #cdd6f4;
            --shadow-strong: rgba(0, 0, 0, 0.8);
        }

        body[theme="catppuccin-frappe"] {
            background: url("/assets/media/background/skibididdy.jpg") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
            --card-bg: rgba(0, 0, 0, 0.5);
            --glass-border: rgba(255, 255, 255, 0.2);
            --primary-light: #cdd6f4;
            --shadow-strong: rgba(0, 0, 0, 0.8);
        }

        body[theme="catppuccin-macchiato"] {
            background: url("/assets/media/background/rizzyaf.gif") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
            --card-bg: rgba(0, 0, 0, 0.5);
            --glass-border: rgba(255, 255, 255, 0.2);
            --primary-light: #cdd6f4;
            --shadow-strong: rgba(0, 0, 0, 0.8);
        }

        body[theme="catppuccin-mocha"] {
            background: url("/assets/media/background/senkbucketup.webp") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
            --card-bg: rgba(0, 0, 0, 0.5);
            --glass-border: rgba(255, 255, 255, 0.2);
            --primary-light: #cdd6f4;
            --shadow-strong: rgba(0, 0, 0, 0.8);
        }

        body[theme="default"] {
            background: url("/assets/media/background/canthurtmewmyogscantnerfmesandyop.png") no-repeat center center fixed;
            background-size: cover;
            --shadow: rgba(0, 0, 0, 0.01);
            --text: #cdd6f4;
            --card-bg: rgba(0, 0, 0, 0.5);
            --glass-border: rgba(255, 255, 255, 0.2);
            --primary-light: #cdd6f4;
            --shadow-strong: rgba(0, 0, 0, 0.8);
        }

        /* --- Intro Animation CSS --- */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.15);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
            opacity: 1;
        }

        #preloader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .animated-content {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }

        .animated-content.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- Live Clock Styles --- */
        #live-clock {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8em;
            font-weight: 600;
            color: var(--primary-light);
            text-shadow: 0 2px 5px var(--shadow-strong);
            margin-bottom: 25px;
            background-color: var(--card-bg);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 10px;
            padding: 10px 20px;
            border: 1px solid var(--glass-border);
            display: inline-block;
        }

        @media (max-width: 768px) {
            #live-clock {
                font-size: 1.4em;
                margin-bottom: 20px;
                padding: 8px 15px;
            }
        }

        /* --- New/Modified Styles for Integrated Content & Music Player --- */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            justify-content: space-between; /* Distribute space between header, main, footer */
        }

        .nav-container {
            display: flex;
            justify-content: center;
            padding: 15px 0;
            background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent background for nav */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            z-index: 100; /* Ensure nav is above content */
        }

        .nav-links {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
            gap: 20px;
        }

        .nav-links a {
            color: var(--text);
            text-decoration: none;
            font-size: 1.1em;
            padding: 10px 15px;
            border-radius: 8px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-links a:hover,
        .nav-links a.active {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .container {
            flex-grow: 1; /* Allows the main content to fill available space */
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
        }

        .container-inner {
            background-color: var(--card-bg);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 5px 20px var(--shadow);
            border: 1px solid var(--glass-border);
            color: var(--text);
            max-width: 900px; /* Limit width of content container */
            width: 100%;
        }

        /* Hidden sections for content switching */
        .page-section {
            display: none;
            /* Initially hide all sections */
        }

        .page-section.active {
            display: block;
            /* Show the active section */
        }

        .music-player-controls {
            background-color: rgba(0, 0, 0, 0.8);
            /* Dark, slightly transparent background */
            color: var(--text);
            padding: 15px 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
            margin-top: auto; /* Pushes the player to the bottom */
            z-index: 100;
        }

        .music-player-controls button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--text);
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 1.1rem;
            transition: background-color 0.3s, border-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .music-player-controls button:hover:not(:disabled) {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .music-player-controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #current-song-title {
            margin: 0 15px;
            font-weight: bold;
            flex-grow: 1;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 250px; /* Limit width */
        }

        #music-search {
            padding: 10px;
            border-radius: 5px;
            border: none;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text);
            width: 180px;
            outline: none;
        }

        #music-search::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        #music-list {
            margin-top: 15px;
            width: 100%;
            max-height: 250px;
            overflow-y: auto;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 10px;
        }

        .music-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: background-color 0.2s;
            border-radius: 5px;
        }

        .music-item:last-child {
            border-bottom: none;
        }

        .music-item:hover,
        .music-item.active {
            background-color: rgba(255, 255, 255, 0.15);
        }

        .music-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-grow: 1;
            color: var(--text);
        }

        .item-actions button {
            margin-left: 8px;
            font-size: 0.9rem;
            padding: 6px 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .ai-analysis-output {
            background-color: rgba(0, 0, 0, 0.6);
            /* Darker background for analysis */
            padding: 10px;
            margin-top: 8px;
            border-radius: 5px;
            font-size: 0.9em;
            color: #eee;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .no-music-message {
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Styles for specific content sections (e.g., Games, Settings) */
        #games-content, #apps-content, #settings-content, #web-music-content {
            padding: 20px;
            text-align: left; /* Align text within sections */
        }

        #games-content h2, #apps-content h2, #settings-content h2, #web-music-content h2 {
            margin-top: 0;
            color: var(--primary-light); /* Example: Use a theme color */
        }
        #games-content ul, #apps-content ul, #settings-content ul {
            list-style: none;
            padding: 0;
            display: grid; /* For a grid layout of items */
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            max-height: 400px; /* Example: limit height for scrollability */
            overflow-y: auto;
        }
        #games-content li, #apps-content li {
            background-color: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            transition: transform 0.2s ease, background-color 0.2s ease;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        #games-content li:hover, #apps-content li:hover {
            transform: translateY(-3px);
            background-color: rgba(255, 255, 255, 0.15);
        }
        #games-content li a, #apps-content li a {
            text-decoration: none;
            color: var(--text);
            display: block;
            font-weight: bold;
        }

        /* Settings specific styles */
        .settings-option {
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .settings-option label {
            flex-grow: 1;
            margin-right: 10px;
        }
        .settings-option select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(0, 0, 0, 0.3);
            color: var(--text);
        }
    </style>
</head>

<body>
    <div id="preloader">
        <div class="spinner"></div>
    </div>

    <nav class="animated-content">
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="#home" data-section="home" class="active"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="#games" data-section="games"><i class="fas fa-gamepad"></i> Games</a></li>
                <li><a href="#apps" data-section="apps"><i class="fas fa-mobile-alt"></i> Apps</a></li>
                <li><a href="#settings" data-section="settings"><i class="fas fa-cogs"></i> Settings</a></li>
                <li><a href="#web-music" data-section="web-music"><i class="fas fa-music"></i> Web Music</a></li>
            </ul>
        </div>
    </nav>

    <div class="container animated-content">
        <div class="container-inner">
            <div id="home-content" class="page-section active">
                <div id="live-clock"></div>
                <h1>SKrypt</h1>
                <h2>Where unblocking possibilities are endless</h2>
                <div class="search-container">
                    <div class="search-box">
                        <form id="fv" method="POST">
                            <input id="iv" class="input" placeholder="Search through the web freely...">
                            <button class="search-btn"><i class="fas fa-search"></i></button>
                        </form>
                    </div>
                </div>
                <button class="open-blank-btn" onclick="aboutblank()">
                    <i class="fas fa-external-link-alt"></i> Open about:blank
                </button>
            </div>

            <div id="games-content" class="page-section">
                <h2>Games üéÆ</h2>
                <p>Enjoy a collection of exciting games!</p>
                <ul>
                    <li><a href="#" onclick="alert('Launching Game 1!')">Game 1: Block Breaker</a></li>
                    <li><a href="#" onclick="alert('Launching Game 2!')">Game 2: Snake Classic</a></li>
                    <li><a href="#" onclick="alert('Launching Game 3!')">Game 3: 2048 Puzzle</a></li>
                    <li><a href="#" onclick="alert('Launching Game 4!')">Game 4: Tetris</a></li>
                    <li><a href="#" onclick="alert('Launching Game 5!')">Game 5: Flappy Bird</a></li>
                    <li><a href="#" onclick="alert('Launching Game 6!')">Game 6: Minesweeper</a></li>
                    </ul>
            </div>

            <div id="apps-content" class="page-section">
                <h2>Apps üì±</h2>
                <p>Access useful applications directly.</p>
                <ul>
                    <li><a href="#" onclick="alert('Opening Calculator!')">Calculator</a></li>
                    <li><a href="#" onclick="alert('Opening Notepad!')">Notepad</a></li>
                    <li><a href="#" onclick="alert('Opening Converter!')">Unit Converter</a></li>
                    </ul>
            </div>

            <div id="settings-content" class="page-section">
                <h2>Settings ‚öôÔ∏è</h2>
                <p>Customize your SKrypt experience.</p>
                <div class="settings-option">
                    <label for="theme-select">Select Theme:</label>
                    <select id="theme-select" onchange="setTheme(this.value)">
                        <option value="skibididdy">Skibididdy (Cyberpunk GIF)</option>
                        <option value="cuhs">Popping That GTV</option>
                        <option value="cuhs2">Standing</option>
                        <option value="cuhs3">Pacific</option>
                        <option value="catppuccin-frappe">Catppuccin Frappe</option>
                        <option value="catppuccin-macchiato">Catppuccin Macchiato</option>
                        <option value="catppuccin-mocha">Catppuccin Mocha</option>
                        <option value="default">Default</option>
                    </select>
                </div>
                <div class="settings-option">
                    <label>Other setting option:</label>
                    <input type="checkbox" checked> Enable Feature X
                </div>
                </div>

            <div id="web-music-content" class="page-section">
                <h2>Web Music üé∂</h2>
                <p>Your ultimate music playlist. Play a song below!</p>
                <input type="text" id="music-search" placeholder="Search music...">
                <div id="music-list"></div>
            </div>

        </div>
    </div>

    <div class="music-player-controls animated-content">
        <audio id="audio-player" controls style="display:none;"></audio>
        <div class="player-buttons">
            <button id="prev-button" title="Previous Song"><i class="fas fa-step-backward"></i></button>
            <button id="play-pause-button" title="Play/Pause"><i class="fas fa-play"></i></button>
            <button id="next-button" title="Next Song"><i class="fas fa-step-forward"></i></button>
        </div>
        <div id="current-song-title">No song playing</div>
        </div>

    <script src="themesandcuhs.js"></script>
    <script src="/callfall.js"></script>
    <script src="/assets/js/i.js?v=03"></script>
    <script src="./assets/ultra/bundle.js?v=10-02-2024"></script>
    <script src="./assets/ultra/config.js?v=10-02-2024"></script>
    <script src="/assets/js/f.js"></script>
    <script src="/assets/js/mv.js?v=003"></script>
    <script src="/assets/js/m.js?v=08"></script>
    <script src="/assets/js/settings.js?v=010"></script>
    <script>
        // Place custom scripts that rely on specific elements after those elements.

        // --- Theme Setting (moved here for clarity and immediate application) ---
        const savedTheme = localStorage.getItem('theme') || 'cuhs3';
        document.body.setAttribute('theme', savedTheme);

        // Define the setTheme function globally, accessible from HTML's onchange
        function setTheme(theme) {
            document.body.setAttribute('theme', theme);
            localStorage.setItem('theme', theme);
            // Optionally, update the select dropdown to reflect the current theme
            document.getElementById('theme-select').value = theme;
        }

        // --- Intro Animation JavaScript ---
        window.addEventListener('load', () => {
            const preloader = document.getElementById('preloader');
            const animatedElements = document.querySelectorAll('.animated-content');

            setTimeout(() => {
                preloader.classList.add('hidden');
                animatedElements.forEach(element => {
                    element.classList.add('show');
                });
                // After intro, show the correct section based on URL hash
                showSectionFromHash();
                updateActiveNavLink();
                // Initialize the theme select dropdown value
                const themeSelect = document.getElementById('theme-select');
                if (themeSelect) {
                    themeSelect.value = savedTheme;
                }
            }, 500);
        });

        // --- Client-Side Routing and Section Management ---
        const navLinks = document.querySelectorAll('.nav-links li a');
        const pageSections = document.querySelectorAll('.page-section'); // All content sections

        function showSection(sectionId) {
            pageSections.forEach(section => {
                section.classList.remove('active'); // Hide all sections
            });
            const activeSection = document.getElementById(sectionId + '-content');
            if (activeSection) {
                activeSection.classList.add('active'); // Show the target section
            }
        }

        function updateActiveNavLink() {
            const currentHash = window.location.hash.substring(1) || 'home'; // Get hash without #, default to 'home'
            navLinks.forEach(link => {
                if (link.getAttribute('data-section') === currentHash) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }

        function showSectionFromHash() {
            const currentHash = window.location.hash.substring(1); // Get hash without #
            if (currentHash && currentHash !== '') {
                showSection(currentHash);
            } else {
                // Default to 'home' section if no hash or empty hash
                showSection('home');
                history.replaceState(null, '', '#home'); // Update URL to #home
            }
            updateActiveNavLink();
        }

        // Event listeners for navigation links
        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault(); // Prevent default link behavior
                const sectionId = link.getAttribute('data-section');
                history.pushState(null, '', '#' + sectionId); // Update URL hash
                showSection(sectionId); // Show the corresponding section
                updateActiveNavLink(); // Update active class
            });
        });

        // Handle browser's back/forward buttons (popstate event)
        window.addEventListener('popstate', () => {
            showSectionFromHash(); // Show section based on new hash
            updateActiveNavLink(); // Update active nav link
        });

        // --- Web Music Player JavaScript ---
        const audioPlayer = document.getElementById('audio-player');
        const playPauseButton = document.getElementById('play-pause-button');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const currentSongTitle = document.getElementById('current-song-title');
        // Music search and list are now inside #web-music-content, so they need to be fetched *after* it's rendered.
        // We'll define these inside a function that runs when the web music section is made active.
        let musicSearchInput;
        let musicListDiv;

        const allSongs = [
            { name: "Feel it - d4vd", url: "https://raw.githubusercontent.com/razzlerazing2/SKrypt/main/music/feel-it-dvad.mp3" },
            { name: "Squabble Up - Kendrick Lamar", url: "https://raw.githubusercontent.com/razzlerazing2/SKrypt/main/music/spotifydown.com - squabble up - Kendrick Lamar.mp3" },
            { name: "Hide - Juice WRLD", url: "https://raw.githubusercontent.com/razzlerazing2/SKrypt/main/music/Hide (feat. Seezyn) - Juice WRLD.mp3" },
            // Add more songs here
        ];

        let filteredPlaylist = [...allSongs];
        let currentSongIndex = 0;

        function loadSong(index) {
            if (filteredPlaylist.length === 0) {
                audioPlayer.src = '';
                currentSongTitle.textContent = 'No song playing';
                playPauseButton.disabled = true;
                prevButton.disabled = true;
                nextButton.disabled = true;
                return;
            }

            currentSongIndex = (index + filteredPlaylist.length) % filteredPlaylist.length;
            const song = filteredPlaylist[currentSongIndex];
            audioPlayer.src = song.url;
            currentSongTitle.textContent = song.name;
            audioPlayer.play().catch(error => {
                console.error("Autoplay prevented:", error);
            });
            playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
            playPauseButton.disabled = false;
            prevButton.disabled = false;
            nextButton.disabled = false;
            updateActiveSongInList();
        }

        function togglePlayPause() {
            if (audioPlayer.paused) {
                audioPlayer.play();
                playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                audioPlayer.pause();
                playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        function playNextSong() {
            loadSong(currentSongIndex + 1);
        }

        function playPrevSong() {
            loadSong(currentSongIndex - 1);
        }

        function renderMusicList() {
            // Ensure musicListDiv is defined (it's part of #web-music-content)
            if (!musicListDiv) {
                musicListDiv = document.getElementById('music-list');
                if (!musicListDiv) return; // Exit if not found (e.g., if web-music-content isn't active yet)
            }

            musicListDiv.innerHTML = '';
            if (filteredPlaylist.length === 0) {
                musicListDiv.innerHTML = '<p class="no-music-message">No matching music found. Try a different search!</p>';
                return;
            }

            filteredPlaylist.forEach((song, index) => {
                const musicItem = document.createElement('div');
                musicItem.classList.add('music-item');
                musicItem.setAttribute('data-index', index);
                musicItem.innerHTML = `
                    <div class="music-info">
                        <i class="fas fa-music"></i>
                        <span>${song.name}</span>
                    </div>
                    <div class="item-actions">
                        <button class="play-song-btn" title="Play this song"><i class="fas fa-play"></i></button>
                        <button class="ai-analyze-btn" title="Get AI Analysis ‚ú®"><i class="fas fa-magic"></i></button>
                    </div>
                    <div class="ai-analysis-output hidden">
                        <p class="loading-analysis hidden">Analyzing...</p>
                        <p class="analysis-text"></p>
                    </div>
                `;
                musicListDiv.appendChild(musicItem);

                musicItem.querySelector('.play-song-btn').addEventListener('click', () => {
                    loadSong(index);
                });

                musicItem.querySelector('.ai-analyze-btn').addEventListener('click', (event) => {
                    getSongAnalysis(song.name, event.currentTarget);
                });
            });
            updateActiveSongInList();
        }

        function updateActiveSongInList() {
            document.querySelectorAll('.music-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeItem = document.querySelector(`.music-item[data-index="${currentSongIndex}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }

        function searchMusic() {
            // Ensure musicSearchInput is defined
            if (!musicSearchInput) {
                musicSearchInput = document.getElementById('music-search');
                if (!musicSearchInput) return; // Exit if not found
            }

            const searchTerm = musicSearchInput.value.toLowerCase();
            filteredPlaylist = allSongs.filter(song =>
                song.name.toLowerCase().includes(searchTerm)
            );
            renderMusicList();

            const currentSong = filteredPlaylist[currentSongIndex];
            if (!currentSong || !currentSong.name.toLowerCase().includes(searchTerm)) {
                if (filteredPlaylist.length > 0) {
                    loadSong(0);
                } else {
                    audioPlayer.pause();
                    audioPlayer.src = '';
                    currentSongTitle.textContent = 'No song playing';
                    playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
                    playPauseButton.disabled = true;
                    prevButton.disabled = true;
                    nextButton.disabled = true;
                }
            } else {
                updateActiveSongInList();
            }
        }

        // --- AI Song Analysis Functionality ---
        async function getSongAnalysis(songName, buttonElement) {
            const musicItem = buttonElement.closest('.music-item');
            const analysisOutput = musicItem.querySelector('.ai-analysis-output');
            const loadingAnalysis = musicItem.querySelector('.loading-analysis');
            const analysisText = musicItem.querySelector('.analysis-text');

            if (!analysisOutput.classList.contains('hidden') && analysisText.textContent !== '') {
                analysisOutput.classList.add('hidden');
                analysisText.textContent = '';
                return;
            }

            analysisOutput.classList.remove('hidden');
            loadingAnalysis.classList.remove('hidden');
            analysisText.textContent = '';
            buttonElement.disabled = true;

            const prompt = `Provide a brief (2-3 sentences), creative description and suggest a mood/vibe for the song titled "${songName}". Focus on general musical characteristics or feelings it evokes.`;
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; // Leave this as-is; Canvas will provide it at runtime.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("Gemini API Error:", response.status, response.statusText, errorData);
                    analysisText.textContent = `Error: Could not get analysis. ${errorData.error.message || 'Please try again.'}`;
                    return;
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    analysisText.textContent = result.candidates[0].content.parts[0].text;
                } else {
                    analysisText.textContent = "Could not generate analysis for this song.";
                    console.error("Unexpected Gemini API response structure:", result);
                }
            } catch (error) {
                console.error("Network or API Call Error:", error);
                analysisText.textContent = "Failed to connect to AI. Check your internet connection.";
            } finally {
                loadingAnalysis.classList.add('hidden');
                buttonElement.disabled = false;
            }
        }


        // Event Listeners for player controls
        playPauseButton.addEventListener('click', togglePlayPause);
        prevButton.addEventListener('click', playPrevSong);
        nextButton.addEventListener('click', playNextSong);
        audioPlayer.addEventListener('ended', playNextSong);
        // Event listener for search input - needs to be added after the element exists
        document.addEventListener('DOMContentLoaded', () => {
            musicSearchInput = document.getElementById('music-search');
            musicListDiv = document.getElementById('music-list'); // Ensure this is fetched too
            if (musicSearchInput) {
                musicSearchInput.addEventListener('keyup', searchMusic);
            }
            renderMusicList(); // Initial render of the music list
            loadSong(currentSongIndex); // Load the first song
        });


        audioPlayer.addEventListener('play', () => {
            playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
        });
        audioPlayer.addEventListener('pause', () => {
            playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
        });

        // --- Live Clock JavaScript ---
        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            let minutes = now.getMinutes();
            let seconds = now.getSeconds();
            const ampm = hours >= 12 ? 'PM' : 'AM';

            hours = hours % 12;
            hours = hours ? hours : 12;
            minutes = minutes < 10 ? '0' + minutes : minutes;
            seconds = seconds < 10 ? '0' + seconds : seconds;

            const timeString = `${hours}:${minutes}:${seconds} ${ampm}`;
            document.getElementById('live-clock').textContent = timeString;
        }

        setInterval(updateClock, 1000);
        updateClock();

        // about:blank function (already provided)
        function aboutblank() {
            var win = window.open('about:blank');
            var url = 'index.html'; // This will open your current index.html in about:blank
            var iframe = win.document.createElement('iframe');
            iframe.style = "position:fixed;width:100vw;height:100vh;top:0px;left:0px;right:0px;bottom:0px;z-index:2147483647;background-color:white;border:none;";
            iframe.src = url;
            win.document.body.appendChild(iframe);

            window.location.href = 'https://portal.friscoisd.org'; // Redirects the original window
        }
    </script>
</body>

</html>